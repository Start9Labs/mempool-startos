import { timeoutPromise } from "./index";
/**
 * Running a health script, is used when we want to have a simple
 * script in bash or something like that. It should return something that is useful
 * in {result: string} else it is considered an error
 * @param param0
 * @returns
 */
export const runHealthScript = async (effects, runCommand, { timeout = 30000, errorMessage = `Error while running command: ${runCommand}`, message = (res) => `Have ran script ${runCommand} and the result: ${res}`, } = {}) => {
    const res = await Promise.race([
        effects.runCommand(runCommand, { timeoutMillis: timeout }),
        timeoutPromise(timeout),
    ]).catch((e) => {
        effects.console.warn(errorMessage);
        effects.console.warn(JSON.stringify(e));
        effects.console.warn(e.toString());
        throw { status: "failing", message: errorMessage };
    });
    return {
        status: "passing",
        message: message(res),
    };
};
