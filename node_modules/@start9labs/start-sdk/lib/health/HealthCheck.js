import { defaultTrigger } from "./trigger/defaultTrigger";
export function healthCheck(o) {
    new Promise(async () => {
        let currentValue = {
            hadSuccess: false,
        };
        const getCurrentValue = () => currentValue;
        const trigger = (o.trigger ?? defaultTrigger)(getCurrentValue);
        for (let res = await trigger.next(); !res.done; res = await trigger.next()) {
            try {
                const { status, message } = await o.fn();
                await o.effects.setHealth({
                    name: o.name,
                    status,
                    message,
                });
                currentValue.hadSuccess = true;
                currentValue.lastResult = "passing";
            }
            catch (_) {
                currentValue.lastResult = "failing";
            }
        }
    });
    return {};
}
